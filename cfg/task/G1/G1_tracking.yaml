name: G1TRACKING

defaults:
  # see https://hydra.cc/docs/advanced/overriding_packages/
  - /task/G1/G1
  - _self_

robot: 
  name: g1_col_full_self

action:
  _target_: active_adaptation.envs.mdp.action.JointPosition
  action_scaling: 
    .*elbow_joint: 1.0
    .*shoulder.*: 1.0
    .*wrist.*: 1.0
    .*hip_roll.*: 0.5
    .*hip_yaw.*: 0.5
    .*hip_pitch.*: 0.5
    .*knee.*: 0.5
    .*waist.*: 0.5
    .*ankle.*: 0.5
  alpha: [0.9, 0.9]
  max_delay: 3
  delay_full_progress: 0.8
  boot_protect: True
  boot_delay_steps: 6

flags: []
command:
  _target_: active_adaptation.envs.mdp.commands.motion_tracking.MotionTrackingComplianceCommand
  keypoint_map: {}
  keypoint_patterns: ["head_mimic", ".*_hand_mimic", ".*wrist_roll_link.*", ".*shoulder_yaw_link", ".*knee.*", ".*ankle_roll_link"]
  lower_keypoint_patterns: [".*knee.*", ".*ankle_roll_link"]
  upper_keypoint_patterns: ["head_mimic", ".*_hand_mimic", ".*wrist_roll_link.*", ".*shoulder_yaw_link"]
  feet_patterns: ["left_ankle_roll_link", "right_ankle_roll_link"]
  feet_standing_z_enter: 0.18
  feet_standing_z_exit: 0.25
  feet_standing_vxy_enter: 0.2
  feet_standing_vxy_exit: 0.3
  feet_standing_vz_enter: 0.15
  feet_standing_vz_exit: 0.25
  ignore_joint_patterns: [".*ankle.*"]
  joint_patterns: [".*hip.*", ".*knee.*", ".*shoulder.*", ".*elbow.*", ".*wrist.*", ".*waist.*"]
  dataset:
    mem_paths:
      - lafan_all
      - amass_all
      - 100style
      - amass_hard
    path_weights:
      - 0.3
      - 0.3
      - 0.3
      - 0.1
  dataset_extra_keys: []
  future_steps: [0, 2, 4, 8, 16]
  cum_root_pos_scale: 1.5
  cum_keypoint_scale: 0.25
  cum_orientation_scale: 0.7
  body_z_terminate_thres: 0.25
  body_z_terminate_patterns: ["pelvis", ".*_hand_mimic", ".*ankle_roll.*"]
  reinit_prob: 0.8
  reinit_min_steps: 25
  reinit_max_steps: 75
  gravity_terminate_thres: 0.5
  boot_indicator_max: 25
  init_noise:
    root_pos: 0.03
    root_ori: 0.1
    root_lin_vel: 0.1
    root_ang_vel: 0.1
    joint_pos: 0.1
    joint_vel: 0.1
  reward_sigma:
    root_pos: [0.3]
    root_vel: [1.0]
    root_rot: [0.4]
    root_ang_vel: [3.0]
    
    keypoint: [0.3] # product
    keypoint_vel: [1.0] # product
    keypoint_rot: [0.4] # product
    keypoint_angvel: [3.0] # product
    lower_keypoint: [0.2] # product
    upper_keypoint: [0.3] # product

    joint_pos: [0.5] # product
    joint_vel: [3.0] # product

observation:
  policy:
    boot_indicator_state_obs: {}
    command_obs: {noise_std: 0.025}
    compliance_flag_obs: {}
    raw_target_joint_pos_obs: {noise_std: 0.01}
    target_root_z_obs: {}
    target_projected_gravity_b_obs: {}

    root_angvel_b_history:     {history_steps: [0], noise_std: 0.05}
    projected_gravity_history: {history_steps: [0], noise_std: 0.01}

    joint_pos_history:         {history_steps: [0, 1, 2, 3, 4, 8], noise_std: 0.01}
    prev_actions:   {steps: 3}
  priv:
    # tracking
    target_joint_pos_obs: {}
    target_pos_b_obs: {}
    target_rot_b_obs: {}
    target_linvel_b_obs: {}
    target_angvel_b_obs: {}
    # bodies
    current_keypoint_pos_b_obs: {}
    current_keypoint_rot_b_obs: {}
    current_keypoint_linvel_b_obs: {}
    current_keypoint_angvel_b_obs: {}
    target_keypoints_pos_b_obs: {}
    target_keypoints_rot_b_obs: {}
    # root
    root_linvel_b_history:     {history_steps: [0, 1, 2, 3, 4, 5, 6, 7, 8], noise_std: 0.0}
    root_angvel_b_history:     {history_steps: [0, 1, 2, 3, 4, 5, 6, 7, 8], noise_std: 0.0}
    projected_gravity_history: {history_steps: [0, 1, 2, 3, 4, 5, 6, 7, 8], noise_std: 0.0}
    # joint
    joint_pos_history:         {history_steps: [0, 1, 2, 3, 4, 5, 6, 7, 8], noise_std: 0.0}
    applied_action:   {}
    applied_torque:   {}
    # feet & support
    body_height:      {body_names: ["pelvis", "torso_link", ".*ankle_roll_link"]}
    feet_contact_state:   {body_names: [.*ankle_roll_link]}
    target_feet_contact_state_obs: {}
  priv_critic:
    cum_error:        {}

reward:
  tracking:
    root_pos_tracking:     {weight: 0.5}
    root_rot_tracking:  {weight: 0.5}
    root_vel_tracking:     {weight: 1.0}
    root_ang_vel_tracking: {weight: 1.0}

    keypoint_tracking:     {weight: 1.0}
    keypoint_vel_tracking: {weight: 1.0}
    keypoint_rot_tracking: {weight: 1.0}
    keypoint_angvel_tracking: {weight: 1.0}
    lower_keypoint_tracking: {weight: 0.5}
    upper_keypoint_tracking: {weight: 0.5}

    joint_pos_tracking:    {weight: 1.0}
    joint_vel_tracking:    {weight: 0.5}
  loco:
    survival:           {weight: 3.0, enabled: true}
    # impact_force_l2:    {weight: 4.0, enabled: true, body_names: .*ankle_roll_link}
    # feet_slip:          {weight: 2.0, enabled: true, body_names: .*ankle_roll_link}
    joint_vel_l2:       {weight: 5.0e-4, enabled: true, joint_names: .*}
    action_rate_l2:     {weight: 0.01, enabled: true}
    feet_air_time_ref:  {weight: 5.0, enabled: true, body_names: [left_ankle_roll_link, right_ankle_roll_link], thres: 0.5}
    feet_air_time_ref_dense:  {weight: 1.0, enabled: true, body_names: [left_ankle_roll_link, right_ankle_roll_link], body2_names: [left_ankle_roll_link_toe, right_ankle_roll_link_toe], air_h_low: 0.035, air_h_high: 0.155, contact_h_low: 0.035, contact_h_high: 0.125}
    joint_pos_limits:   {weight: 1.0, joint_names: ".*", soft_factor: 0.9, enabled: true}
    joint_torque_limits: {weight: 0.01, joint_names: ".*", soft_factor: 0.75, enabled: true}
    feet_contact_count: {weight: 1.0, enabled: false, body_names: .*ankle_roll_link, }

randomization:
  perturb_body_com:
    body_names: ["pelvis", "torso_link"]
    com_range: [-0.02, 0.02]
  perturb_body_mass:
    pelvis: [0.9, 1.1]
    torso_link: [0.9, 1.1]
  perturb_body_materials:
    body_names: ".*ankle_roll_link"
    static_friction_range: [0.5, 1.5]
    solref_time_constant_range: [0.015, 0.03]
    solref_dampratio_range: [0.5, 2.0]
    homogeneous: true
  motor_params_implicit:
    stiffness_range:
      .*: [0.8, 1.2]
    damping_range:
      .*: [0.8, 1.2]
    armature_range:
      .*: [0.75, 1.25]
  random_joint_offset: 
    .*: [-0.01, 0.01]

termination:
  # cum_error: {thres: 1.0, min_steps: 50}
  body_z_termination: {}
  gravity_dir_termination: {}
